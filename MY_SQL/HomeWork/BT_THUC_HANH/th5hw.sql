DROP DATABASE IF EXISTS QUANLYTHITUYENSINH;
CREATE DATABASE TH5HWQUANLYTHITUYENSINH;

USE QUANLYTHITUYENSINH;

CREATE TABLE THISINH (
	SOBD VARCHAR(12) , CONSTRAINT PK_SOBD PRIMARY KEY (SOBD) , 
	HOTEN VARCHAR(50), 
	LOPCHUYEN VARCHAR(6)
);
CREATE TABLE MONTHI(
	MON VARCHAR(6) NOT NULL UNIQUE,
    HESO INT,
    GHICHU VARCHAR (50)
);

CREATE TABLE KETQUA(
	SOBD VARCHAR(12),
    MON VARCHAR(6),
    DIEM INT,
	CONSTRAINT FK_KQ_MON FOREIGN KEY(MON) REFERENCES MONTHI(MON)
);

# Thêm khoá chính sau khi đã tạo bảng
ALTER TABLE MONTHI ADD CONSTRAINT PK_MON PRIMARY KEY(MON);

# Thêm khoá ngoại sau khi đã tạo bảng
ALTER TABLE THISINH ADD CONSTRAINT FK_TS_LC FOREIGN KEY(LOPCHUYEN) REFERENCES MONTHI(MON);
ALTER TABLE KETQUA ADD CONSTRAINT FK_KQ_SBD FOREIGN KEY(SOBD) REFERENCES THISINH(SOBD);

# THÊM DỮ LIỆU VÀO BẢNG MONTHI
INSERT INTO MONTHI VALUES ('TIN',2,'Môn chuyên cho lớp chuyên Tin');
INSERT INTO MONTHI VALUES ('TOAN',2,'Môn chung cho tất cả thí sinh');
INSERT INTO MONTHI VALUES ('VAN',1,'Mon chung cho tất cả thí sinh');
INSERT INTO MONTHI VALUES ('TOANCH',2,'Môn chuyên cho lớp chuyên Toán');
INSERT INTO MONTHI VALUES ('VANCH',2,'Môn chuyên cho lớp chuyên Văn');


INSERT INTO THISINH VALUES('120001', 'NGUYEN DUY KHANH', 'TIN');
INSERT INTO THISINH VALUES('120002', 'NGUYEN VAN HUNG', 'TIN');
INSERT INTO THISINH VALUES('120003', 'NGUYEN HUU CHINH', 'VANCH');
INSERT INTO THISINH VALUES('120004', 'TRAN THI NAU', 'VANCH');
INSERT INTO THISINH VALUES('120005', 'NGUYEN THANH NGHIA', 'TOANCH');
INSERT INTO THISINH VALUES('120006', 'NGUYEN THI TRINH', 'TOANCH');


# THÊM DỮ LIỆU VÀO BẢNG KETQUA
INSERT INTO KETQUA VALUES ('120001','TIN',10);
INSERT INTO KETQUA VALUES ('120001','TOAN',5);
INSERT INTO KETQUA VALUES ('120001','VAN',8);
INSERT INTO KETQUA VALUES ('120002','TIN',10);
INSERT INTO KETQUA VALUES ('120002','TOAN',8);
INSERT INTO KETQUA VALUES ('120002','VAN',10);
INSERT INTO KETQUA VALUES ('120003','TOAN',2);
INSERT INTO KETQUA VALUES ('120003','VAN',2);
INSERT INTO KETQUA VALUES ('120003','VANCH',1);
INSERT INTO KETQUA VALUES ('120004','TOAN',0);
INSERT INTO KETQUA VALUES ('120004','VAN',0);
INSERT INTO KETQUA VALUES ('120004','VANCH',0);
INSERT INTO KETQUA VALUES ('120005','TOAN',10);
INSERT INTO KETQUA VALUES ('120005','TOANCH',10);
INSERT INTO KETQUA VALUES ('120005','VAN',8);
INSERT INTO KETQUA VALUES ('120006','TOAN',6);
INSERT INTO KETQUA VALUES ('120006','TOANCH',4);
INSERT INTO KETQUA VALUES ('120006','VAN',5);


 

-- 1
SELECT DISTINCT T.*
FROM quanlythituyensinh.thisinh AS T
INNER JOIN quanlythituyensinh.ketqua AS K
ON T.SOBD = K.SOBD
WHERE K.DIEM >= 8 ;



-- 2
SELECT T.*,K.DIEM
FROM quanlythituyensinh.thisinh AS T
INNER JOIN quanlythituyensinh.ketqua AS K
ON T.SOBD = K.SOBD 
WHERE K.MON IN ('TOANCH','VANCH');


-- 3

SELECT DISTINCT T.*
FROM quanlythituyensinh.thisinh AS T,quanlythituyensinh.ketqua AS K
WHERE K.MON IN ('TOANCH','VANCH') AND K.DIEM <= 5 OR 
K.MON IN ('TOAN','VAN','TIN') AND K.DIEM <= 2 
AND K.SOBD = T.SOBD;


-- 4
SELECT T.SOBD, T.HOTEN
FROM quanlythituyensinh.thisinh AS T
INNER JOIN quanlythituyensinh.ketqua AS K
ON T.SOBD = K.SOBD 
WHERE K.DIEM = 0 AND K.MON IN ('VAN','TOAN','TIN')
GROUP BY T.SOBD, T.HOTEN
HAVING COUNT(K.MON) >= 2;



-- 5
SELECT T.*
FROM quanlythituyensinh.thisinh AS T
INNER JOIN quanlythituyensinh.ketqua AS K
ON T.SOBD = K.SOBD 
WHERE K.MON IN ('TOANCH','VANCH') AND K.DIEM = 10;



-- 6

SELECT * 
FROM quanlythituyensinh.thisinh AS T
INNER JOIN quanlythituyensinh.ketqua AS K
ON T.SOBD = K.SOBD 
WHERE K.MON IN ('TOANCH','VANCH')
ORDER BY K.DIEM DESC 
LIMIT 1;


-- 7
SELECT T.HOTEN,SUM(K.DIEM)
FROM quanlythituyensinh.thisinh AS T
INNER JOIN quanlythituyensinh.ketqua AS K
ON T.SOBD = K.SOBD
INNER JOIN quanlythituyensinh.monthi AS M
ON K.MON = M.MON
GROUP BY T.HOTEN 
ORDER BY SUM(K.DIEM) DESC 
LIMIT 1;


-- 8
SELECT T.*,K.DIEM
FROM quanlythituyensinh.thisinh AS T
INNER JOIN quanlythituyensinh.ketqua AS K
ON T.SOBD = K.SOBD
WHERE K.DIEM < 5;



-- 9
SELECT DISTINCT T.*
FROM quanlythituyensinh.thisinh AS T,quanlythituyensinh.ketqua AS K
WHERE K.MON IN ('TOANCH','VANCH') AND K.DIEM <= 5 AND 
K.MON IN ('TOAN','VAN','TIN') AND K.DIEM <= 2 
AND K.SOBD = T.SOBD;


-- 10


SELECT T.SOBD,T.HOTEN
FROM quanlythituyensinh.thisinh AS T
JOIN quanlythituyensinh.ketqua AS K1 
ON K1.SOBD = T.SOBD 
JOIN quanlythituyensinh.ketqua AS K2 
ON K2.SOBD = T.SOBD
INNER JOIN quanlythituyensinh.ketqua AS K3
ON K3.SOBD = T.SOBD 
WHERE (K1.MON IN ('TOANCH','VANCH') AND K1.DIEM >= 5)
AND (K2.MON IN ('TOAN','VAN','TIN') AND K2.DIEM >= 2)
AND ((K1.DIEM * 2) + (K2.DIEM)) >= 20
AND K3.SOBD = K1.SOBD AND K3.SOBD = K2.SOBD AND K3.SOBD = T.SOBD 
GROUP BY T.SOBD,T.HOTEN;












